<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>The space.</title>

<script id="vertex-shader-object" type="x-shader/x-vertex">
    precision mediump float;

    attribute vec3 vPosition;
    attribute vec3 vNormal;
    attribute vec2 vTexture;

    uniform mat4 model;
    uniform mat4 view_projection;

    varying vec3 normal;
    varying vec4 pos;
    varying vec2 textureCoord;


    void main() {
        normal = vNormal;
        textureCoord = vTexture;
        pos = model * vec4(vPosition,1);
        gl_Position = view_projection * pos;
        pos /= pos.w;
    }

</script>
<script id="fragment-shader-object" type="x-shader/x-fragment">
    precision mediump float;

    varying vec2 textureCoord;
    varying vec3 normal;
    varying vec4 pos;

    uniform vec3 lightPos;
    uniform vec3 uColor;
    uniform float objectType;
    uniform sampler2D uSampler;

    void main() {
        vec3 lightDir = normalize(lightPos - pos.xyz);
        float dotNL = dot(lightDir, normalize(normal));
        vec3 color = vec3(0.4,0.4,0.4);
        if (objectType == 2.0)
        {
            color = uColor;
        }
        
        if (objectType == 1.0) // Background, not enlightened
        {
          gl_FragColor = texture2D(uSampler, vec2(textureCoord.s,textureCoord.t));
        }
        else if(dotNL > 0.0) // Enlightened
        {
          color += vec3(0.4,0.4,0.4) * dotNL;
          vec3 toEye = lightDir;
          vec3 reflect = -lightDir - 2. * (dot(normalize(normal),-lightDir)) * normalize(normal);
          float specFact = pow(clamp(dot(toEye,reflect),0.0,1.0),2.0);
          color += specFact * vec3(0.2,0.2,0.2);
          gl_FragColor = vec4(color,1.0);
        }
        else // dark
        {
          // pink
          gl_FragColor = vec4(color, 1.0);
        }
    }

</script>

<script type="text/javascript" src="common/webgl-utils.js"></script>
<script type="text/javascript" src="common/initShaders.js"></script>
<script type="text/javascript" src="common/MV.js"></script>
<script type="text/javascript" src="common/webgl-obj-loader.js"></script>
<script type="text/javascript" src="common/webgl-utils.js"></script>
<script type="text/javascript" src="common/helpers.js"></script>
<script type="text/javascript" src="game-object.js"></script>
<script type="text/javascript" src="camera.js"></script>
<script type="text/javascript" src="app.js"></script>


</head>

<body>
  <div id="container">
    <canvas id="gl-canvas" width="860" height="640"></canvas>
    <div id="hud"></div> <br/>
    <button class="button" id='restart'>Restart</button>
    <button class="button" id='harakiri'>HARAKIRI!</button>
  </div>

</body>

</html>
